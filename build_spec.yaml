version: 0.1
component: build
timeoutInSeconds: 10000
shell: bash
runAs: root
failImmediatelyOnError: true
env:
  variables:
    TEST: "some text"
  #vaultVariables:
    #key: "secret-id"
  exportedVariables:
    - APPLICATION_VERSION
steps:
  - type: Command
    name: "Extract the version of the applicacion"
    command: |
      export APPLICATION_VERSION=$(echo $RANDOM)
      echo $APPLICATION_VERSION
      cd ${OCI_PRIMARY_SOURCE_DIR}
      echo Inside of the working directory OCI_PRIMARY_SOURCE_DIR - Working in `pwd`
      echo 'All the files in this directory `ls -l`'
    onFailure:
      - type: Command
        command: |
          echo "Handling the failure"
        timeoutInSeconds: 400
  - type: VulnerabilityAudit
    name: "Vulnerability Audit Step"
    configuration:
      buildType: maven
      pomFilePath: ${OCI_PRIMARY_SOURCE_DIR}/pom.xml
      packagesToIgnore:
        - com.oracle.*
        - org.apache.logging
      maxPermissibleCvssV2Score: 6.0
      maxPermissibleCvssV3Score: 6.0
    knowledgeBaseId: ocid1.admknowledgebase.oc1.phx.amaaaaaanf25m3qa6puwcopqgjpf2ygsz5nf4cerdeuiosxnfnd6zfl34n2a
    vulnerabilityAuditCompartmentId: ocid1.compartment.oc1..aaaaaaaayrtdxlkhtj743elimx7mnpdlummsralzxwsk3irgvvhr6pmxbc7q
    vulnerabilityAuditName: Vuln_Scan_Report
      